<!DOCTYPE html>
<html lang="en">
<head>
    <title>Mocha</title>
    <script src="/prism.js"></script>
    <link rel="stylesheet" href="/css/prism.css">
    <link rel="stylesheet" href="/css/main.css">
</head>

<body>
<h1>Автоматическое тестирование с использованием фреймворка <b>Mocha</b></h1>
<hr>

<h2>Behavior Driver Development (BDD)</h2>
<p>Ниже будет пример для понимания: что такое <b>BDD</b></p>
<hr>
<h3>Разработка функции </h3>
<p>Для примера мы будем писать функцию, которая будет возводить полученый аргумент <code class="lang-js">x</code> в степень <code class="lang-js">n</code>.</p>
<p>Перед тем, как начать писать код функции, мы можем представить себе, что она должна делать, и описать ее. Такое описание будет называться <em>спецификацией</em>. Она содержит описания различных способов использования и тесты для них, например: </p>

<pre><code class="lang-js">describe('pow', function() {
    
    it('возводить в степень n', function(){
        assert.equal(pow(2, 3), 8);
    });

});</code></pre>

<p>Специфика состоит из трёх основных блоков:</p>
<ol>
    <li><p><code class="lang-js">describe('заголовок', function() {...})</code> <br>
    Какую функциональность мы описываем. В нашем случае мы описываем функцию <code class="lang-js">pow</code>. Используется для группировки рабочих лошадок - блоков < class="lang-js">it</ code>.</p></li>

    <li><p><code class="lang-js">it('описание', function() {...})</code> <br>
    В первом аргументе блока <code class="lang-js">it</code> мы человеческим языком описываем конкретный способ использования функции, а во втором - пишем функцию, которая тестирует данный случай.</p></li>

    <li><p><code class="lang-js">assert.equak(pow(2, 3), 8);</code> <br>
    Код внутри блока<code class="lang-js">it</code>, если функция работает верно, должен выполняться без ошибок.</p></li>
</ol>

<p>Функции вида <code class="lang-js">assert.</code> используются для проверки того, что функция <code class="lang-js">pow</code> работает так, как мы ожидаем. В этом примере мы используем одну из них - <code class="lang-js">assert.equal</code>, которая сравнивает переданные значения и выбрасывает ошибку, если они не равны друг другу. Существуют и другие типы сравнений и проверок, которые мы добавим позже.</p>
<hr>

<h3>Процесс разработки</h3>
<p>Процесс разработки обычно выглядит следующим образом:</p>
<ol>
    <li>Пишется начальная спецификация с тестами, проверяющими основную функциональность.</li>
    <li>создается начальная реализация</li>
    <li>Для запуска тестов мы используем фреймворк <b>Mocha</b>. Пока функция не готова, будут ошибки. Вносим изменения до тех пор, пока всё не начнет работать так, как нужно.</li>
    <li>Теперь у нас есть правильно работающая начальная реализация и тесты.</li>
    <li>Мы добавляем новые способы использования в спецификацию, возможно, еще не реализованные в тестируемом коде. Тесты начинают падать(выдавать ошибки)</li>
    <li>Возвращаемся на шаг 3, дописываем реализацию до тех пор, пока тесты не начнут завершаться без ошибок.</li>
    <li>Повторяем шаги 3-6, пока требуемая функциональность не будет готова.</li>
</ol>

<p>Первый шаг уже завершен, у нас есть спецификация для функции <code class="lang-js">pow</code>. Теперь, перед тем, как писать реализацию, давайте подключим библиотеки для пробного запуска тестов, просто чтобы убедиться, что тесты работают (они завершатся ошибками).</p>
<hr>

<h3>спецификация в действии</h3>
<p>Нам понадобятся следующие библиотеки:</p>

<ul>
    <li><a style="color:royalblue;" href="https://mochajs.org/">Mocha</a> - основной фреймворк. Он представляет общие функции тестирования, такие как <code class="lang-js">describe</code> и <code class="lang-js">it</code>, а также функцию запусков тестов.</li>
    <li><a style="color:royalblue;" href="https://www.chaijs.com/">Chai</a> - библиотекаЮ предоставляющая множество функций проверки отверждений. Пока мы будем использовать только <code class="lang-js">assert.equal</code>.</li>
    <li><a style="color:royalblue;" href="https://sinonjs.org/">Sinon</a> - библиотека, позволяющая наблюдать за функциями, эмулировать встроенные функции и многое другое. Нам она пригодится позднее.</li>
</ul>

<p>Есть два пути организации тестов:</p>

<ol>
    <li>Добавить <code class="lang-js">assert</code> в <code class="lang-js">it</code>:
        <pre><code class="lang-js"> describe("pow", function() {
    it("возводит число в степень n", function() {
        assert.equal(pow(2, 3), 8);
        assert.equal(pow(3, 3), 27);
    });
 });</code></pre></li>
    <li>Написать два теста:
        <pre><code class="lang-js"> describe("pow", function() {
    it("2 в степени 3 будет 8", function() {
        assert.equal(pow(2, 3), 8);
    });
    it("3 в степени 3 будет 27", function() {
        assert.equal(pow(3, 3), 27);
    });
 });</code></pre></li>
</ol>

<p>Принципиальная разница в том, что когда один <code class="lang-js">assert</code> выбрасывает ошибку, то выполнение блока <code class="lang-js">it</code> сразу прекращается.</p>
<hr>
<h4 style="margin-inline: 300px;">Один тест проверяет одну вещь!</h4>
<hr>

<pre><code class="lang-js"></code></pre>
</body>
</html>

